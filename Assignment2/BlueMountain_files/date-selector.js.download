define("dateSelector",function(require){var i18nlang;var winLang=document.documentElement.lang;if(winLang&&winLang.startsWith("fr")){i18nlang={previousMonth:"",nextMonth:"",months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdays:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],weekdaysShort:["D","L","M","M","J","V","S"]}}else{i18nlang={previousMonth:"",nextMonth:"",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["S","M","T","W","T","F","S"]}}var $=require("jquery"),Pikaday=require("pikaday"),pluginName="dateSelector",helpers=require("helpers"),defaults={modal:false,reposition:true,field:"input",container:".date-selector-wrapper",desktopBreakpoint:Modernizr.mq("only screen and (min-width: 1024px)"),tabletBreakpoint:Modernizr.mq("only screen and (min-width: 756px)"),smallBreakpoint:Modernizr.mq("only screen and (max-width: 767px)"),isMobile:Modernizr.touch,minDate:new Date,defaultDate:new Date,i18n:i18nlang,onSelect:$.noop,numberOfMonths:1};var DateSelector=function(element,options){this.element=element;this.datepicker={};this._isOpening=false;if($(this.element).hasClass("two-letter-week-labels")){if(winLang&&winLang.startsWith("fr")){defaults.i18n.weekdaysShort=["DI","LU","MA","ME","JE","VE","SA"]}else{defaults.i18n.weekdaysShort=["SU","MO","TU","WE","TH","FR","SA"]}}else{if(winLang&&winLang.startsWith("fr")){defaults.i18n.weekdaysShort=["D","L","M","M","J","V","S"]}else{defaults.i18n.weekdaysShort=["S","M","T","W","T","F","S"]}}this.options=$.extend({},defaults,options);this.$modal=[];this.init();this.timer=null};DateSelector.prototype={init:function(){setPikadayDateFormat();this._setModal();this._cacheDom();this._create();this._attachHandlers()},get:function(){return this.datepicker},getDate:function(){return this.datepicker.getDate()},toString:function(){return this.datepicker.toString()},_cacheDom:function(){this.$element=$(this.element);this.$container=this.$element.find(this.options.container);this.$field=this.$element.find(this.options.field);this.$trigger=this.$element.find(this.options.trigger);this.hasContainer=this.$container.length?true:false;this.hasField=this.$field.length?true:false;this.hasTrigger=this.$trigger.length?true:false;if(this.options.additionalLabel&&this.options.additionalLabel.length){this.additionalLabel=this.$element.find(this.options.additionalLabel).text();if(this.additionalLabel&&this.additionalLabel.length){this.additionalLabel='<span class="pika-add-label">'+this.additionalLabel+"</span>"}}},_create:function(){var p=new Pikaday({i18n:this.options.i18n,showDaysInNextAndPreviousMonths:true,minDate:this.options.minDate,defaultDate:this.options.defaultDate,setDefaultDate:true,yearSuffix:this.additionalLabel,reposition:false,field:this.hasField?this.$field[0]:null,trigger:this.hasTrigger?this.$trigger[0]:null,container:this.hasContainer?this.$container[0]:null,onDraw:$.proxy(this.options.onDraw||this._onDraw,this),onOpen:$.proxy(this._onOpen,this),onClose:$.proxy(this.options.onClose||this._onClose,this),onSelect:$.proxy(this.options.onSelect,this),setPosition:$.proxy(this.options.setPosition||this._setPosition,this),numberOfMonths:this.options.numberOfMonths});this.datepicker=p;this.$datepickerEl=$(p.el);if(this.options.preventHideOnSelect){this.datepicker.reallyHide=this.datepicker.hide;this.datepicker.hide=$.noop}},_attachHandlers:function(){$(window).on("resize",$.proxy(helpers.debounce(this._setPosition,100,false),this));$(window).on("resize",$.proxy(helpers.debounce(this._setModal,100,false),this))},_onDraw:function(){this._setPosition(true);this._isOpening=false},_onOpen:function(){this.timer=window.setTimeout($.proxy(function(){this.timer=null},this),100);this._isOpening=true;this._setPosition();this.$container.show();if(this.options.modal){$("body").append(this.$modal)}if(this.options.onOpen){$.proxy(this.options.onOpen,this)()}},_onClose:function(){if(this.timer!==null){this.datepicker.show();return}this.$container.hide();if(this.options.modal){this.$modal.remove()}var strVal=this.toString();if(strVal){this.$field.val(strVal)}},_setPosition:function(checkIfOpening){this.options.desktopBreakpoint=Modernizr.mq("only screen and (min-width: 1024px)");this.options.tabletBreakpoint=Modernizr.mq("only screen and (min-width: 768px)");this.options.isMobile=Modernizr.mq("only screen and (max-width: 767px)")&&Modernizr.touch;if(!this.options.reposition){return}if(checkIfOpening&&this._isOpening){return}if(this.hasContainer&&this.options.smallBreakpoint||this.hasContainer&&!this.options.tabletBreakpoint){if(this.$element.closest(".needs-stick").length>0){this.$container.css({top:"100%"})}else{this.$container.css({top:"-"+(this.$container.outerHeight()+5)+"px"})}}else if(this.hasContainer&&!this.options.isMobile||this.hasContainer&&this.options.tabletBreakpoint){this.$container.css({top:this.$element.outerHeight()+1+"px"})}else if(this.hasTrigger){this.$datepickerEl.css({top:this.$trigger.offset().top-this.$trigger.outerHeight(),left:"50%"})}else{this.$datepickerEl.css({top:this.$field.offset().top,left:"50%"})}},_setModal:function(){var el=$(this.element);if(el.data("datepickerModal")){this.options.modal=el.data("datepickerModal")}if(this.options.modal){this.$modal=$("<div></div>").addClass(pluginName+"_modal mobile-only")}}};$.fn[pluginName]=function(methodOrOptions){var method,options;if(typeof methodOrOptions==="string"){method=DateSelector.prototype[methodOrOptions];return method.apply(this.data("plugin_"+pluginName))}options=methodOrOptions;return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new DateSelector(this,options))}})};function setPikadayDateFormat(){Pikaday.prototype.toString=function(){var date=this._d;return helpers.dateToUrlStringFormat(date)}}return});