define("carousel",function(require){"use strict";var helpers=require("helpers"),$=require("jquery");require("swipe");var defaults={root:null,shouldAutoplay:false,autoplayDelay:5e3,hasPagers:true,hasSecondaryPagers:false,hasPagination:true,before:null,after:null,changeCallback:null,advanceSlideOnClick:false,continuous:true,pagerButtonSelector:"button",overlaySelector:".overlay-wrapper",slideHeight:"",slideSelector:".slide",mediaItemsSelector:".media-item-element",pagerContainerSelector:null,paginationContainerSelector:null,secondaryPagerContainerSelector:null,pagerContainerClass:"button-container",prevButtonClass:"prev",nextButtonClass:"next",paginationClass:"pagination-button-container",activePageClass:"currentPage",isMobile:false,hasDots:false,dotsContainerClass:"dots-button-container",onSlideClicked:$.noop};function create(options){var carousel={};carousel.options=$.extend({},defaults,options);bind(carousel);carousel.cacheDom();carousel.startCarousel();return carousel}function bind(carousel){carousel.cacheDom=cacheDom.bind(carousel);carousel.recacheDom=recacheDom.bind(carousel);carousel.startCarousel=startCarousel.bind(carousel);carousel.triggerHeightCallback=triggerHeightCallback.bind(carousel);carousel.onPagerClick=onPagerClick.bind(carousel);carousel.buildPagerButtons=buildPagerButtons.bind(carousel);carousel.buildPagination=buildPagination.bind(carousel);carousel.onPaginationClick=onPaginationClick.bind(carousel);carousel.attachHandlers=attachHandlers.bind(carousel);carousel.advanceSlideOnClick=advanceSlideOnClick.bind(carousel);carousel.onSlideChange=onSlideChange.bind(carousel);carousel.slideChanged=slideChanged.bind(carousel);carousel.returnToFirstSlide=returnToFirstSlide.bind(carousel);carousel.goToSlide=goToSlide.bind(carousel);carousel.autoplay=autoplay.bind(carousel);carousel.generateGuid=generateGuid.bind(carousel);carousel.removeVideoOverlay=removeVideoOverlay.bind(carousel);carousel.buildDots=buildDots.bind(carousel);carousel.createInstance=createInstance.bind(carousel);carousel.kill=kill.bind(carousel);carousel.setup=setup.bind(carousel);carousel.onSlideClicked=onSlideClicked.bind(carousel)}function cacheDom(){this.dom={};this.dom.html=$("html");this.dom.body=helpers.dom.body;this.dom.root=this.options.root;this.dom.pagerButtons=this.dom.root.find(this.options.pagerButtonSelector);this.dom.slides=this.dom.root.find(this.options.slideSelector);this.dom.mediaItems=this.dom.root.find(this.options.mediaItemsSelector);this.dom.slideCount=this.dom.slides.length;this.dom.videoOverlay=this.dom.slides.find(this.options.overlaySelector)}function startCarousel(){if(helpers.isPageEditor){return}if(this.dom.slides.length>1){this.createInstance();this.buildPagerButtons();this.buildPagination();this.buildDots();this.attachHandlers();this.onSlideChange(0,true);if(typeof this.options.after==="function"){this.options.after()}this.autoplayTimeout=0;if(this.options.shouldAutoplay&&!this.options.isMobile){this.autoplay()}}else{this.createInstance();this.attachHandlers()}}function createInstance(options){var self=this,defaults={callback:self.slideChanged},root=self.dom.root[0];options=$.extend({},defaults,options);self.triggerHeightCallback();self.carousel=new Swipe(root,options);$(root).on("carousel-resize",function(){self.carousel.setup()});if(self.dom.slideCount===2){self.dom.hiddenSlides=self.dom.root.find(self.options.slideSelector).filter(":gt(1)")}}function buildPagerButtons(){var hasPagers=this.options.hasPagers,hasSecondaryPagers=this.options.hasSecondaryPagers,targetEl=this.options.pagerContainerSelector?$(this.options.pagerContainerSelector):this.dom.root,secondaryContainer=this.options.secondaryPagerContainerSelector?$(this.options.secondaryPagerContainerSelector):this.dom.root;if(hasPagers==="desktop"){hasPagers=!("ontouchstart"in document.documentElement)}if(hasPagers&&this.dom.slideCount>1){this.dom.buttons=$('<button class="'+this.options.prevButtonClass+'"></button><button class="'+this.options.nextButtonClass+'"></button>');var container=$("<div>").attr("class",this.options.pagerContainerClass).append(this.dom.buttons);this.dom.buttons.on("click",this.onPagerClick);targetEl.append(container);if(hasSecondaryPagers){this.dom.secondaryPagerButtons=$('<button class="'+this.options.prevButtonClass+'"></button><button class="'+this.options.nextButtonClass+'"></button>');var secondaryButtonContainer=$("<div>").attr("class",this.options.pagerContainerClass).append(this.dom.secondaryPagerButtons);this.dom.secondaryPagerButtons.on("click",this.onPagerClick);secondaryContainer.append(secondaryButtonContainer)}}}function buildPagination(){var pagers="",targetEl=this.options.paginationContainerSelector?$(this.options.paginationContainerSelector):this.dom.root,currentPage,page;if(this.options.hasPagination&&this.dom.slideCount>1){for(var i=0;i<this.dom.slides.length;i++){currentPage=i+1;page="<li><button>page: "+currentPage+"</button></li>";pagers+=page}pagers=$("<ol>").html(pagers);this.dom.pagerContainer=$("<div>").attr("class",this.options.paginationClass).html(pagers);targetEl.append(this.dom.pagerContainer);this.dom.pagerListItems=this.dom.pagerContainer.find("button");this.dom.pagerListItems.on("click",this.onPaginationClick)}}function buildDots(){var pagers="",targetEl=this.options.paginationContainerSelector?$(this.options.paginationContainerSelector):this.dom.root,currentPage,page;var slide3dIndexes=[];for(var d=0;d<this.dom.slides.length;d++){if($(this.dom.slides[d]).find(".media-item-iframe-wrapper").length>0){slide3dIndexes.push(d)}}if(this.options.hasDots&&this.dom.slideCount>1){for(var i=0;i<this.dom.slides.length;i++){currentPage=i+1;if(slide3dIndexes.indexOf(i)!==-1){page='<li><button class="three-d">page: '+currentPage+"</button></li>"}else{page="<li><button>page: "+currentPage+"</button></li>"}pagers+=page}pagers=$("<ul>").attr("class","carousel-dots").html(pagers);this.dom.pagerContainer=$("<div>").attr("class",this.options.dotsContainerClass).html(pagers);targetEl.append(this.dom.pagerContainer);this.dom.pagerListItems=this.dom.pagerContainer.find("button");this.dom.pagerListItems.on("click",this.onPaginationClick)}}function attachHandlers(){var that=this;this.dom.root.on("click",this.options.slideSelector,this.advanceSlideOnClick);this.dom.slides.on("click",this.onSlideClicked);if(this.dom.hiddenSlides){this.dom.hiddenSlides.on("click",this.onSlideClicked)}this.dom.root.parents(".dynamic-tabs-content").on("tabChanged",this.carousel.setup);this.dom.root.on("keydown",function(e){if(e.keyCode===37||e.keyCode===40){that.carousel.prev()}if(e.keyCode===38||e.keyCode===39){that.carousel.next()}})}function recacheDom(){this.dom.root=this.options.root;this.dom.pagerButtons=this.dom.root.find(this.options.pagerButtonSelector);this.dom.slides=this.dom.root.find(this.options.slideSelector);this.dom.mediaItems=this.dom.root.find(this.options.mediaItemsSelector);this.dom.slideCount=this.dom.slides.length;this.dom.videoOverlay=this.dom.slides.find(this.options.overlaySelector);if(!this.dom.pagerContainer){console.log("No pagerContainer found");return}this.dom.pagerListItems=this.dom.pagerContainer.find("button")}function kill(){if(this.carousel){this.carousel.kill()}}function setup(){if(this.carousel){this.carousel.setup()}}function generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function autoplay(){var delay=this.options.autoplayDelay,self=this;if(!self.options.shouldAutoplay){return}this.autoplayTimeout=setTimeout(function(){if(!self.options.shouldAutoplay){return}self.carousel.next();self.autoplay()},delay)}function triggerHeightCallback(){if(typeof this.options.before==="function"){this.options.before(self.dom.slides,this.options.slideHeight)}}function onPagerClick(e){e.preventDefault();var button=$(e.currentTarget),index;if(button.hasClass(this.options.nextButtonClass)){index=this.currentPage-1<0?this.dom.slideCount-1:this.currentPage-1}else{index=this.currentPage+1>=this.dom.slideCount?0:this.currentPage+1}this.currentPage=index;this.carousel.slide(index);clearTimeout(this.autoplayTimeout);if(this.options.shouldAutoplay){this.autoplay()}}function onPaginationClick(e){e.preventDefault();var button=$(e.currentTarget),index=this.dom.pagerListItems.index(button);this.carousel.slide(index)}function onSlideClicked(e){var element=$(e.currentTarget),index=this.dom.slides.index(element);this.options.shouldAutoplay=false;this.options.onSlideClicked({index:index,slide:element})}function removeVideoOverlay(e){var element=$(e.currentTarget),shouldOpenLightboxInstead=element.parents(".carousel-with-lightbox-wrapper").length>0,chosenSlideMediaItem=element.parents(".slide").find(".media-item-element").first(),vidThumbnail=element.parent().find(".vid-thumbnail"),slideMediaItem=this.dom.mediaItems.filter("#"+chosenSlideMediaItem.attr("id")),indexSlide=this.dom.mediaItems.index(slideMediaItem);if(!shouldOpenLightboxInstead||Modernizr.mq("only screen and (max-width: 767px)")){if(this.autoplayObjects!==null&&this.autoplayObjects[indexSlide]!==undefined&&this.autoplayObjects[indexSlide]!==null){this.autoplayObjects[indexSlide].play()}element.hide();vidThumbnail.hide()}}function advanceSlideOnClick(e){var touchSupport=this.dom.html.hasClass("modernizr-touch")||this.dom.html.hasClass("modernizr-touchevents");if(!touchSupport&&this.options.advanceSlideOnClick){e.preventDefault();this.carousel.next()}}function slideChanged(index){this.onSlideChange(index,false)}function onSlideChange(index,isSetupCall){var newPager,countIsEven,indexIsEven,hasLightboxParent=this.dom.slides.closest(".lightbox-content").length>0;if(index>=this.dom.slideCount){countIsEven=this.dom.slideCount%2===0;indexIsEven=index%2===0;if(countIsEven){this.currentPage=indexIsEven?0:1}else{this.currentPage=indexIsEven?1:0}}else{this.currentPage=index}this.dom.slides.removeClass(this.options.activePageClass);$(this.dom.slides[this.currentPage]).addClass(this.options.activePageClass);if(this.options.hasPagination&&this.dom.slideCount>1){newPager=this.dom.pagerListItems.eq(this.currentPage);this.dom.pagerListItems.removeClass(this.options.activePageClass);newPager.addClass(this.options.activePageClass)}if(this.options.hasDots&&this.dom.slideCount>1){newPager=this.dom.pagerListItems.eq(this.currentPage);this.dom.pagerListItems.removeClass(this.options.activePageClass);newPager.addClass(this.options.activePageClass)}if(this.options.changeCallback){this.options.changeCallback(index,this.options.root)}if(hasLightboxParent){var mediaItemTitle=$(this.dom.slides[this.currentPage]).data("title");$(this.dom.slides.parents(".lightbox-content")).find(".lightbox-title").text(mediaItemTitle)}this.dom.slides.trigger("onSlideChange",index)}function returnToFirstSlide(){if(this.carousel.getPos()!==0){this.carousel.slide(0)}}function goToSlide(slideIndex){if(slideIndex<0)return;this.carousel.slide(slideIndex)}return{create:create}});