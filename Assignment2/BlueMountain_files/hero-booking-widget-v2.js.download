define(function(require){"use strict";require("dateSelector");var $=require("jquery"),helpers=require("helpers"),Accordion=require("accordion"),autoScrollSpeed=2500,isMobile=helpers.windowWidthLessThan(768),dom;return init();function init(){setTimeout(function(){cacheDom();scrollOut();attachHandlers();animateOpening();showSelectedBookingType();adjustDatePickers()},100)}function cacheDom(){dom={};dom.bookingWidgetContainer=$(".hero-booking-widget-wrapper-v2");dom.heroWrapper=dom.bookingWidgetContainer.closest(".hero-wrapper");dom.heroImageWrappers=dom.heroWrapper.find(".hero-background-image, .hero-background-video");dom.bookingWidget=dom.bookingWidgetContainer.find(".booking-widget");dom.mobileBookingWidget=$(".mobile-hero-booking-widget-v2");dom.submitLinks=dom.mobileBookingWidget.find(".booking-type-submit .submit");dom.mobileBookingTypesBar=dom.bookingWidgetContainer.find(".booking-types-bar");dom.mobileBookingIconButtons=dom.mobileBookingTypesBar.find("button");dom.bookingTypesBar=dom.bookingWidgetContainer.find(".booking-types-bar");dom.bookingIconButtons=dom.bookingTypesBar.find("button");dom.dateSelectors=dom.bookingWidgetContainer.find(".date-selector");dom.mobileAccordionBookingTypes=dom.bookingWidgetContainer.find(".booking-type.show-accordion")}function attachHandlers(){dom.submitLinks.on("mousedown",updateButtonLinkHref);dom.bookingIconButtons.on("click touchstart",onClickIconButton);$(window).on("resize",$.proxy(helpers.debounce(adjustBookingWidget,100,false),this));if(dom.mobileAccordionBookingTypes.length>0){dom.mobileAccordionBookingTypes.each(function(){Accordion.create({root:$(this),titleSelector:".booking-type-label",itemsSelector:".booking-options"})})}}function adjustBookingWidget(){if(isMobile!==helpers.windowWidthLessThan(768)){showSelectedBookingType();dom.bookingWidget.find(".dropdown.dropdown-wrapper").removeClass("hidden")}}function adjustDatePickers(){if(helpers.windowWidthLessThan(768)){dom.dateSelectors.each(function(){$(this).attr("data-datepicker-modal",true)})}else{dom.dateSelectors.each(function(){$(this).attr("data-datepicker-modal",false)})}}function animateOpening(){if(helpers.isPageEditor){updateCss()}else{dom.bookingWidget.animate({opacity:"1"},updateCss)}}function updateCss(){if(dom.bookingWidget.length){dom.heroImageWrappers.addClass("has-booking-widget")}dom.bookingWidgetContainer.addClass("loaded");dom.bookingWidget.show()}function updateButtonLinkHref(){var $formContextItem=$(this),$form=$formContextItem.closest("form"),$inputs=$form.find("input, select"),modifiedInputs=[],$input,inputVal,inputOrigVal,inputDefVal,newHref,actionHash,formTarget,$submitLink=$form.find(".booking-type-submit .submit"),serializeForm;$inputs.each(function(){$input=$(this);inputVal=$input.val();inputOrigVal=$input.attr("data-orig-value")||"";inputDefVal=$input.attr("data-default-value")||"";if(inputVal===inputOrigVal){$input.val(inputDefVal);modifiedInputs.push($input)}});serializeForm=$form.serialize();newHref=$form.attr("action")+(serializeForm.length>0?"?":"")+serializeForm;actionHash=$form.data("url-hash");formTarget=$form.attr("target");if(actionHash.length>0){newHref+="#"+actionHash}$submitLink.attr("href",newHref);$submitLink.attr("target",formTarget);window.setTimeout(function(){resetFormValues(modifiedInputs)},1e3);return true}function resetFormValues(inputs){$(inputs).each(function(){$(this).val($(this).data("orig-value"))})}function scrollOut(){if(!helpers.isPageEditor&&isMobile){var widthSpacer=dom.bookingWidgetContainer.width();var widthTypesBar=dom.mobileBookingTypesBar.width();if(widthTypesBar>widthSpacer){dom.mobileBookingTypesBar.animate({scrollLeft:widthTypesBar},autoScrollSpeed,"linear",scrollBack)}}}function scrollBack(){dom.mobileBookingTypesBar.animate({scrollLeft:0},autoScrollSpeed)}function showSelectedBookingType(){var selectedButton=dom.bookingWidgetContainer.find(".booking-types-bar").find("li.selected"),currentValue=selectedButton.data("value");var bookingTypes=dom.bookingWidgetContainer.find(".booking-type");bookingTypes.each(function(i,e){$(this).hide()});bookingTypes.filter(function(){return $(this).data("booking-type")===currentValue}).show()}function onClickIconButton(e){var button=$(this),selectedOption=button.closest("li");var target=$(e.target);var bookingBar=target.closest(".booking-types-bar");var options=bookingBar.find("li");options.each(function(i,e){if(!$(this).hasClass("selected")){return}$(this).removeClass("selected")});selectedOption.addClass("selected");showSelectedBookingType()}});