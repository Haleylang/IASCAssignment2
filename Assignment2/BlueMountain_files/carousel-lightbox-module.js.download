define("carousel-lightbox-module",function(require){"use strict";require("array-from");var $=require("jquery"),MicroModal=require("micromodal"),model={};create();return{attachPageCarouselHandlers:attachPageCarouselHandlers,initialize:initialize,initializeInternally:initializeInternally};function create(){model.hasInitializedInternally=false;model.carouselConfigs={};model.$body=$("body")}function initializeInternally(){model.hasInitializedInternally=true;MicroModal.init({onShow:function(modal){var currentIndex,carouselConfig,carousel,$carouselWrapper;model.$body.addClass("lightbox-open");currentIndex=getCurrentIndex(modal.id);carouselConfig=model.carouselConfigs[modal.id];carousel=carouselConfig.carousel;carousel.setup();$carouselWrapper=carouselConfig.$carouselWrapper;if(carousel.dom.slideCount===2&&currentIndex>1){currentIndex=currentIndex-2}carousel.goToSlide(currentIndex);setLightboxTitle($carouselWrapper,currentIndex);carousel.setup();carouselConfig.onShow(carousel)},onClose:function(modal){var carouselConfig,carousel;model.$body.removeClass("lightbox-open");carouselConfig=model.carouselConfigs[modal.id];carousel=carouselConfig.carousel;carouselConfig.onClose(carousel)}})}function initialize(options){model.carouselConfigs[options.lightboxId]={carousel:options.carousel,$carouselWrapper:options.$carouselWrapper,onShow:options.onShow||$.noop,onClose:options.onClose||$.noop}}function getCurrentIndex(lightboxId){var $pageCarouselWrapper=$(".slides").filter(function(index,carouselWrapper){return $(carouselWrapper).data("lightboxid")===lightboxId});return $pageCarouselWrapper.data("index")||0}function setLightboxTitle($carouselWrapper,slideIndex){var $slide=$($carouselWrapper.find(".slide")[slideIndex]),mediaItemTitle=$slide.data("title");var lightboxContentEl=$carouselWrapper.parents(".lightbox-content");if(lightboxContentEl.length){lightboxContentEl.find(".lightbox-title").text(mediaItemTitle)}}function attachPageCarouselHandlers($carouselWrapper){$carouselWrapper.on("onSlideChange",function(e,index){$(this).data("index",index)})}});