define("carousel-lightbox-video-module",function(require){"use strict";var $=require("jquery"),carouselModule=require("carousel"),carouselLightboxModule=require("carousel-lightbox-module"),videoPlayer=require("video-player"),helpers=require("helpers"),defaults={$carousels:null,$lightboxes:null,$videos:null,onLightboxOpened:$.noop,onLightboxClosed:$.noop,onSlideClicked:$.noop,onSlideChanged:$.noop};return{create:create};function create(options){var carousel={};carousel.options=$.extend({},defaults,options);bind(carousel);carousel.cacheDom();carousel.init();return carousel}function bind(carousel){carousel.cacheDom=cacheDom.bind(carousel);carousel.init=init.bind(carousel);carousel.createInstance=createInstance.bind(carousel);carousel.stopStatePlayingVideo=stopStatePlayingVideo.bind(carousel);carousel.onLightboxOpened=onLightboxOpened.bind(carousel);carousel.onLightboxClosed=onLightboxClosed.bind(carousel);carousel.onSlideClicked=onSlideClicked.bind(carousel);carousel.onSlideChanged=onSlideChanged.bind(carousel)}function cacheDom(){var self=this;self.dom={};self.dom.carousels=self.options.$carousels;self.dom.lightboxes=self.options.$lightboxes;self.dom.videos=self.options.$videos}function init(){var self=this;self.carouselInstances=[];self.videoInstances=[];self.dom.carousels.each(function(index,pageCarousel){var $carouselWrappers=$(pageCarousel).find(".slides");$carouselWrappers.each(function(index,carouselWrapper){var $carouselWrapper=$(carouselWrapper),carouselInstance=self.createInstance($carouselWrapper);self.carouselInstances.push(carouselInstance);carouselLightboxModule.attachPageCarouselHandlers($carouselWrapper)})});self.dom.lightboxes.each(function(index,lightbox){var $carouselWrappers=$(lightbox).find(".slides.non-mobile-block");$carouselWrappers.each(function(index,carouselWrapper){var $carouselWrapper=$(carouselWrapper),carouselInstance;$carouselWrapper.data("autoplay",false);carouselInstance=self.createInstance($carouselWrapper);carouselLightboxModule.initialize({lightboxId:lightbox.id,carousel:carouselInstance,$carouselWrapper:$carouselWrapper,onShow:function(carousel){self.onLightboxOpened(carousel);self.options.onLightboxOpened(carousel)},onClose:function(){self.onLightboxClosed();self.options.onLightboxClosed()}})})});carouselLightboxModule.initializeInternally();self.dom.videos=self.dom.videos.add(self.dom.carousels.find(".video").filter('[id$="-clone"]'));self.dom.videos=self.dom.videos.add(self.dom.lightboxes.find(".video").filter('[id$="-clone"]'));self.dom.videos.each(function(index,element){var carouselWrapper=$(element).closest(".slides"),carouselUsesLightbox=helpers.getBoolFor(carouselWrapper.data("useslightbox")),carouselInLightbox=carouselWrapper.closest(".lightbox").length!==0,carouselIsMobileOnly=carouselWrapper.is(".mobile-only");if(carouselUsesLightbox&&!carouselInLightbox){videoPlayer.createPlaceholderImageOnly($(element)[0]);return}if(carouselIsMobileOnly&&carouselInLightbox){videoPlayer.createPlaceholderImageOnly($(element)[0]);return}self.videoInstances.push({element:element,player:videoPlayer.create($(element)[0],{onFinish:$.noop,isToggleImageOnPlay:true,isToggleOverlayOnPlay:true})})})}function createInstance(carouselWrapper){var self=this;function onSlideClicked(context){self.onSlideClicked(context,carouselWrapper);self.options.onSlideClicked(context,carouselWrapper)}function onSlideChanged(index,carouselRoot){self.onSlideChanged(index,carouselRoot);self.options.onSlideChanged()}return carouselModule.create({root:carouselWrapper,hasPagination:false,hasDots:helpers.getBoolFor(carouselWrapper.data("hasdots")),shouldAutoplay:helpers.getBoolFor(carouselWrapper.data("autoplay")),isMobile:carouselWrapper.hasClass("mobile-only"),onSlideClicked:onSlideClicked,changeCallback:onSlideChanged})}function stopStatePlayingVideo(){var self=this;if(self.playingVideo){try{self.playingVideo.stop();self.playingVideo=null}catch(e){self.playingVideo=null}}}function onLightboxOpened(carousel){var activeSlide=carousel.dom.slides.filter(".currentPage");if(activeSlide.length===1){activeSlide.trigger("click");return}if(carousel.dom.slides.length===1){carousel.dom.slides.trigger("click")}}function onLightboxClosed(){var self=this;self.stopStatePlayingVideo()}function onSlideClicked(context,carouselWrapper){var self=this,playerInstance,$video=context.slide.find(".video"),videoElement,carouselUsesLightbox=helpers.getBoolFor(carouselWrapper.data("useslightbox")),carouselInLightbox=carouselWrapper.closest(".lightbox").length!==0,carouselIsMobileOnly=carouselWrapper.is(".mobile-only");if(carouselUsesLightbox&&!carouselInLightbox){return}if(carouselIsMobileOnly&&carouselInLightbox){return}if($video.length<1){return}videoElement=$video[0];playerInstance=self.videoInstances.filter(function(instance){return instance.element.id===videoElement.id});if(playerInstance.length<1){return}playerInstance=playerInstance[0];self.stopStatePlayingVideo();playerInstance.player.play();self.playingVideo=playerInstance.player}function onSlideChanged(index,carouselRoot){var self=this;if(!self.playingVideo){return}if(!$.contains(carouselRoot[0],self.playingVideo.parentElement)){return}self.stopStatePlayingVideo()}});