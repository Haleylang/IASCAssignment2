define(function(require){var $=require("jquery"),video=require("video-player"),helpers=require("helpers"),modernizr=require("Modernizr"),defaultSettings={heroWrapper:undefined,aspectRatioWidth:16,aspectRatioHeight:9,aspectRatioCoefficient:9/16,heroVideo:null},videoIsPlaying=false;function create(settings){var videoHeroModule={};videoHeroModule.settings=$.extend({},defaultSettings,settings);videoHeroModule.state={};bind(videoHeroModule);videoHeroModule.init();return videoHeroModule}function bind(videoHeroModule){videoHeroModule.init=init.bind(videoHeroModule);videoHeroModule.cacheDom=cacheDom.bind(videoHeroModule);videoHeroModule.attachEvents=attachEvents.bind(videoHeroModule);videoHeroModule.createVideo=createVideo.bind(videoHeroModule);videoHeroModule.playVideo=playVideo.bind(videoHeroModule);videoHeroModule.videoOnReady=videoOnReady.bind(videoHeroModule);videoHeroModule.onWindowResize=onWindowResize.bind(videoHeroModule);videoHeroModule.tryResizeVideoProxy=tryResizeVideoProxy.bind(videoHeroModule);videoHeroModule.positionVideoProxy=positionVideoProxy.bind(videoHeroModule);videoHeroModule.centerWideVideo=centerWideVideo.bind(videoHeroModule);videoHeroModule.centerTallVideo=centerTallVideo.bind(videoHeroModule);videoHeroModule.onPlayButtonClicked=onPlayButtonClicked.bind(videoHeroModule);videoHeroModule.isDesktopWidth=isDesktopWidth.bind(videoHeroModule);videoHeroModule.pauseVideo=pauseVideo.bind(videoHeroModule);videoHeroModule.showVideoCredit=showVideoCredit.bind(videoHeroModule);videoHeroModule.hideVideoCredit=hideVideoCredit.bind(videoHeroModule)}function init(){if(helpers.isPageEditor){return}this.state={};this.cacheDom();if(this.isDesktopWidth()){this.createVideo()}this.attachEvents()}function cacheDom(){this.dom={};this.dom.window=helpers.dom.window;this.dom.heroWrapper=this.settings.heroWrapper;this.dom.videoWrapper=this.dom.heroWrapper.find(".individual_hero_video");this.dom.video=this.dom.heroWrapper.find(".video");this.dom.videoSizingProxy=this.dom.heroWrapper.find(".video-sizing-proxy");this.dom.playButton=this.dom.heroWrapper.find(".play_button")}function createVideo(){var sourceType=this.dom.video.hasClass("vimeo")?"vimeo":"youtube";this.video=video.create(this.dom.video,{source:sourceType,onReady:this.videoOnReady});this.state.videoCreated=true}function attachEvents(){this.dom.window.on("resize",this.onWindowResize);this.dom.playButton.on("click",this.onPlayButtonClicked)}function onWindowResize(){if(this.isDesktopWidth()){if(!this.state.videoCreated){this.createVideo()}else{this.tryResizeVideoProxy();this.positionVideoProxy()}}else{if(this.state.videoCreated){this.pauseVideo()}}}function onPlayButtonClicked(){window.open(this.dom.video.data("src"))}function tryResizeVideoProxy(){var wrapperHeight=this.dom.videoWrapper.height();if(!this.state.videoDimensions){return}this.dom.videoSizingProxy.removeAttr("style");if(this.dom.videoSizingProxy.outerHeight()>=wrapperHeight){this.state.isWider=false;return}this.dom.videoSizingProxy.css({height:wrapperHeight+"px",width:wrapperHeight*this.state.videoDimensions.aspectRatio+"px","padding-top":0});this.state.isWider=true}function positionVideoProxy(){if(!this.state.videoDimensions){return}if(this.state.isWider){this.centerWideVideo();return}this.centerTallVideo()}function centerWideVideo(){var wrapperWidth=this.dom.videoWrapper.width(),videoWidth=this.dom.videoSizingProxy.width(),widthDifference=videoWidth-wrapperWidth,widthOffset=Math.floor(widthDifference/2);this.dom.videoSizingProxy.css({left:"-"+widthOffset+"px"})}function centerTallVideo(){var wrapperHeight=this.dom.videoWrapper.height(),videoHeight=this.dom.videoSizingProxy.outerHeight(),heightDifference=videoHeight-wrapperHeight,heightOffset=Math.floor(heightDifference/2);this.dom.videoSizingProxy.css({top:"-"+heightOffset+"px"})}function isDesktopWidth(){return $(this.dom.window).width()>1200}function pauseVideo(){videoIsPlaying=false;this.video.pause();this.hideVideoCredit()}function playVideo(){if(helpers.isPageEditor||videoIsPlaying){return}videoIsPlaying=true;this.video.mute();this.video.play();this.showVideoCredit()}function videoOnReady(){var self=this;this.video.getDimensions(function(dimensions){self.state.videoDimensions=dimensions;self.onWindowResize();self.dom.heroWrapper.find(".video").css({opacity:1});if(self.isDesktopWidth()){self.playVideo();self.showVideoCredit()}else{self.hideVideoCredit()}})}function showVideoCredit(){this.dom.heroWrapper.find(".herovideocredit").removeClass("d-none");this.dom.heroWrapper.find(".heroimagecredit").addClass("d-none")}function hideVideoCredit(){this.dom.heroWrapper.find(".herovideocredit").addClass("d-none");this.dom.heroWrapper.find(".heroimagecredit").removeClass("d-none")}return{create:create}});