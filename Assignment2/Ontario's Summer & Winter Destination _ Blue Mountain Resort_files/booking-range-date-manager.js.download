define("bookingRangeDateManager",function(require){var $=require("jquery");var bookingWidgetDateModule=require("booking-widget-date-module");var create=function(options){var self={pickers:[],init:function(){self.cacheDom();bookingWidgetDateModule.init({datePickerOptions:{display:2,ranged:true,dateChange:this.onDateSelected,inline:true,dark:false}});self.attachHandlers();self.attachWidgets();return self},dom:{},cacheDom:function(){self.dom={};self.dom.bookingTypes=options.dom?$(options.dom.bookingTypes):options.bookingTypes;self.dom.dateSelectors=self.dom.bookingTypes.find(".booking-option.rangedate-selector");self.dom.datePickerContainer=self.dom.dateSelectors.find(".rangedate-selector-wrapper");self.dom.datePickerButtons=self.dom.dateSelectors.find(".datepicker-button");self.dom.startDateLabel=null;self.dom.endDateLabel=null;self.dom.startDateParameter=null;self.dom.endDateParameter=null},attachHandlers:function(){self.dom.datePickerButtons.on("click",function(e){var el=$(e.target);if(el.length==0){return false}var container=el.closest(".rangedate-selector");if(container.hasClass("open")){container.removeClass("open");return}container.addClass("opening");if(container.length==0){return false}self.dom.startDateLabel=$(".checkin",container);self.dom.endDateLabel=$(".checkout",container);var datepicker=$(".date-picker",container);var bookingParameters=datepicker.data("parameters");self.setParameters(bookingParameters,container);self.dom.endDateLabel.on("date-selected",function(e){var el=$(e.currentTarget);if(el.length==0){return false}el.closest(".rangedate-selector").removeClass("open")})});self.dom.bookingTypes.find(".booking-option").on("booking:close",function(e){var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;self.dateSelectorReset(e,force)});self.dom.dateSelectors.find(".booking-button").on("focusin",function(e){var el=$(e.relatedTarget);if(el.parents(".date-container").length>0){self.dateSelectorReset(e,true)}})},setParameters:function(parameters,container){if(!parameters&&parameters.length==0){return}if(parameters.length==1){self.dom.startDateParameter=$('input[name="'+parameters[0]+'"]',container)}if(parameters.length>=1){self.dom.startDateParameter=$('input[name="'+parameters[0]+'"]',container);self.dom.endDateParameter=$('input[name="'+parameters[1]+'"]',container)}},attachWidgets:function(){self.pickers=bookingWidgetDateModule.setupDatePickers(self.dom.dateSelectors)},onDateSelected:function(value){if(!value||!value.dateArray||!value.dateArray.length){return}if(value.startDate===value.endDate){self.dom.endDateLabel.html("");self.dom.endDateParameter.val("");self.dom.endDateLabel.removeClass("selected")}if(value.dateArray.length>=1){var startDisplayDate=bookingWidgetDateModule.getDisplayDateFullMonthFirst(value.startDate);self.dom.startDateLabel.html(startDisplayDate);self.dom.startDateParameter.val(bookingWidgetDateModule.formatDateSelection(value.startDate));self.dom.endDateParameter.val(bookingWidgetDateModule.formatDateSelection(value.endDate,true));self.dom.startDateLabel.addClass("selected")}if(value.dateArray.length>1){var endDisplayDate=" - "+bookingWidgetDateModule.getDisplayDateFullMonthFirst(value.endDate);self.dom.endDateLabel.html(endDisplayDate);self.dom.endDateParameter.val(bookingWidgetDateModule.formatDateSelection(value.endDate));self.dom.endDateLabel.addClass("selected");self.dom.endDateLabel.trigger("date-selected")}if(value.dateArray.length==1){var bookingLabel=self.dom.startDateLabel.parents(".booking-option-label");if(bookingLabel.length>0){bookingLabel.addClass("is-populated")}}},dateSelectorReset:function(el){var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var element=$(el.currentTarget);if(!element.find(".date-container")){if(element.hasClass("open")&&element.not(".opening")){$(".rangedate-selector").removeClass("open")}return}bookingWidgetDateModule.dateSelectorReset(el,self.dom.dateSelectors,force)}};return self.init()};return{create:create}});