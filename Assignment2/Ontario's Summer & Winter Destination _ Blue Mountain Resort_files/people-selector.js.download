define(function(require){var $=require("jquery");var pluginName="peopleSelector",defaults={min:0,max:14};var PeopleSelector=function(element,options){this.element=element;this.options=$.extend({},defaults,options);this.message="";this.init()};PeopleSelector.prototype={init:function(){this._cacheDom();this._attachEvents();this._broadcastUpdate()},_cacheDom:function(){this.dom=$(this.element);this.controls=this.dom.find(".control")},_attachEvents:function(){this.controls.on("click",$.proxy(this._updateInput,this))},_updateInput:function(e){var $el=$(e.target),$input=$el.siblings("input");if($input.size()===0){$el=$el.parent();$input=$el.siblings("input")}var inputVal=Number($input.val()),increment=Number($el.data("increment"));e.stopPropagation();inputVal+=increment;if(inputVal<this.options.min){inputVal=this.options.min}else if(inputVal>this.options.max){inputVal=this.options.max}$input.val(inputVal).change();this._broadcastUpdate()},_updateMessage:function(){var message=[];this.dom.children().each(function(){var msgText="";var label=$(this).find(".label");var num=$(this).find("input").val();var singularLabel=label.data("singular");var pluralLabel=label.data("plural");var labelText=label.text().replace(":","");if(num==1&&singularLabel&&singularLabel.length){msgText=num+" "+singularLabel}else if(num!=1&&pluralLabel&&pluralLabel.length){msgText=num+" "+pluralLabel}else{msgText=num+" "+labelText}message.push(msgText)});this.message=message.join(", ")},_broadcastUpdate:function(){this._updateMessage();this.dom.trigger({type:"peopleSelector.updated",message:this.message})}};$.fn[pluginName]=function(){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new PeopleSelector(this))}})};return});